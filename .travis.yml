# language: swift
# os: osx
# xcode_workspace: BuildAutomationApp.xcworkspace
# xcode_scheme: BuildAutomationApp
# xcode_sdk: iphonesimulator12.4
# osx_image: xcode10.3
# before_install:
# - |
#   brew update
#   gem install xcpretty -N --no-ri --no-doc
#   gem update fastlane
#   pod repo update --silent
# install: pod install
# script:
# - set -o pipefail && xcodebuild clean test -workspace BuildAutomationApp.xcworkspace -scheme BuildAutomationApp -destination "platform=iOS Simulator,name=iPhone 6 Plus" | xcpretty

language: swift
os: osx
before_install:
  - openssl aes-256-cbc -K $encrypted_2040ac2a677b_key -iv $encrypted_2040ac2a677b_iv -in scripts.tar.enc -out scripts.tar -d
  - tar xvf scripts.tar
  - export LANG=en_US.UTF-8
  - brew update
  - brew unlink xctool
  - brew install xctool
  - brew link xctool
  - gem install cocoapods --no-rdoc --no-ri --no-document --quiet
  - gem install xcpretty -N --no-ri --no-doc
  - pod repo update --silent
  - chmod +x scripts/travis/add-key.sh
  - chmod +x scripts/travis/remove-key.sh
  - chmod +x scripts/travis/testflight.sh
install: pod install
before_script:
  - scripts/travis/add-key.sh

script:
  - xctool clean build test -workspace BuildAutomationApp.xcworkspace -scheme BuildAutomationApp -configuration Release -sdk iphonesimulator12.4 CONFIGURATION_BUILD_DIR='~/build/test/'
  - xctool clean build -workspace BuildAutomationApp.xcworkspace -scheme BuildAutomationApp -configuration Release -sdk iphoneos12.4 CONFIGURATION_BUILD_DIR='~/build/release/'

after_script:
  - scripts/travis/remove-key.sh

after_success:
#   - scripts/travis/testflight.sh